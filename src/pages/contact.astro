---
import TemplateLayout from "../layouts/TemplateLayout.astro";

// ✅ 关键：部署到子路径时，BASE_URL 会自动带上前缀（例如 /xxx/）
const BASE = import.meta.env.BASE_URL;

// 图标真实路径：public/images/contacts/...
const icons = {
  wechat: `${BASE}images/contacts/wechat.png`,
  phone: `${BASE}images/contacts/phone.png`,
  email: `${BASE}images/contacts/email.png`,
  whatsapp: `${BASE}images/contacts/whatsapp.png`,
};
---

<TemplateLayout title="联系我们">
  <!-- ===== Banner：沿用模板 fun facts / count-agileits 结构 ===== -->
  <section class="count-agileits subpage-intro contact-banner" aria-label="联系我们简介">
    <div class="container">
      <h3 class="heading">
        <span>联系我们</span>
      </h3>

      <div class="count-grids">
        <div class="count-bgcolor-w3ls">
          <div class="col-md-3 col-sm-6 count-grid">
            <div class="count hvr-bounce-to-bottom intro-card">
              <div class="intro-icon">
                <img src={icons.wechat} alt="WeChat" loading="lazy" />
              </div>
              <h4 class="intro-title">微信</h4>
              <p class="intro-desc">your-wechat-id</p>
            </div>
          </div>

          <div class="col-md-3 col-sm-6 count-grid">
            <div class="count hvr-bounce-to-bottom intro-card">
              <div class="intro-icon">
                <img src={icons.phone} alt="Phone" loading="lazy" />
              </div>
              <h4 class="intro-title">电话</h4>
              <p class="intro-desc">+61 420 616 883</p>
            </div>
          </div>

          <div class="col-md-3 col-sm-6 count-grid">
            <div class="count hvr-bounce-to-bottom intro-card">
              <div class="intro-icon">
                <img src={icons.email} alt="Email" loading="lazy" />
              </div>
              <h4 class="intro-title">邮箱</h4>
              <p class="intro-desc">info@cendantpgau.com</p>
            </div>
          </div>

          <div class="col-md-3 col-sm-6 count-grid">
            <div class="count hvr-bounce-to-bottom intro-card">
              <div class="intro-icon">
                <img src={icons.whatsapp} alt="WhatsApp" loading="lazy" />
              </div>
              <h4 class="intro-title">WhatsApp</h4>
              <p class="intro-desc">+61 420 616 883</p>
            </div>
          </div>

          <div class="clearfix"></div>
        </div>
      </div>
    </div>
  </section>

  <!-- ===== 内容区：恢复你之前“联系我们页面”的结构（电话/邮箱/地址/入口）===== -->
  <div class="contact" id="contact">
    <h3 class="heading"><span>联系我们</span></h3>

    <div class="row">
      <!-- 联系方式 -->
      <div class="col-md-4 col-sm-12 mail">
        <h4>联系方式</h4>
        <p><span class="glyphicon glyphicon-phone"></span> +61 420 616 883</p>
        <p>
          <span class="glyphicon glyphicon-envelope"></span>
          <a href="mailto:info@cendantpgau.com">info@cendantpgau.com</a>
        </p>
        <p>
          <span class="glyphicon glyphicon-comment"></span>
          WeChat：<span>your-wechat-id</span>
        </p>
      </div>

      <!-- 地址 -->
      <div class="col-md-4 col-sm-12 address">
        <h4>地址</h4>
        <p>
          <span class="glyphicon glyphicon-map-marker"></span>
          2 Aquitania Way, Docklands VIC 3008
        </p>
        <p style="opacity:.75; margin-top:10px;">
          可预约面谈 / 线上咨询
        </p>
      </div>

      <!-- 快速入口 -->
      <div class="col-md-4 col-sm-12 social">
        <h4>快速入口</h4>
        <ul>
          <li><a href="/company-profile" aria-label="company"><i class="fa fa-info"></i></a></li>
          <li><a href="/real-estate" aria-label="real-estate"><i class="fa fa-building"></i></a></li>
          <li><a href="/immigration" aria-label="immigration"><i class="fa fa-plane"></i></a></li>
          <li><a href="/loan" aria-label="loan"><i class="fa fa-money"></i></a></li>
        </ul>
      </div>
    </div>

    <div class="clearfix"></div>
  </div>

  <!-- ===== 在线留言（保留你的提交逻辑）===== -->
  <div class="contact-form">
    <h3 class="heading"><span>在线留言</span></h3>
    <div class="container">
      <form id="lead-form">
        <input name="name" type="text" placeholder="姓名" required />
        <input name="email" type="email" placeholder="邮箱" required />
        <input name="phone" type="text" placeholder="电话" />
        <textarea name="message" placeholder="留言内容" required></textarea>
        <button class="btn1" type="submit">提交</button>
        <p id="lead-result" style="margin-top:10px;"></p>
      </form>
    </div>
  </div>

  <script is:inline>
    (function () {
      const form = document.getElementById("lead-form");
      const result = document.getElementById("lead-result");
      if (!form || !result) return;

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        result.textContent = "提交中…";

        const data = Object.fromEntries(new FormData(form));
        data.topic = "联系我们";

        try {
          const res = await fetch("/api/leads", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data),
          });

          if (res.ok) {
            result.textContent = "我们已收到您的信息，会尽快联系您。";
            form.reset();
          } else {
            result.textContent = "提交失败，请稍后再试。";
          }
        } catch (err) {
          result.textContent = "网络异常，请稍后再试。";
        }
      });
    })();
  </script>
</TemplateLayout>

<style is:global>
  /* ===== Banner：白字 + 图标卡片 ===== */
  .contact-banner {
    color: #fff;
  }
  .contact-banner .heading span {
    color: #fff !important;
  }

  .contact-banner .intro-card {
    padding: 18px 16px;
    min-height: 150px;
    display: flex;
    flex-direction: column;
    justify-content: center;
    text-align: center;
  }

  .contact-banner .intro-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 12px;
  }

  .contact-banner .intro-icon img {
    width: 46px;
    height: 46px;
    object-fit: contain;
    display: block;
  }

  .contact-banner .intro-title {
    margin: 0 0 8px;
    font-size: 16px;
    font-weight: 800;
    color: #fff;
  }

  .contact-banner .intro-desc {
    margin: 0;
    font-size: 13px;
    color: rgba(255, 255, 255, 0.88);
    word-break: break-word;
  }

  @media (max-width: 768px) {
    .contact-banner .intro-card { min-height: auto; }
    .contact-banner .intro-icon img { width: 42px; height: 42px; }
  }
</style>
---
import Template20Layout from "../../layouts/Template20Layout.astro";
import { getRealEstatePosts } from "../../lib/contentful";

/**
 * 这里是房产资讯首页
 * 只展示分类入口 + 最新发布
 */
const posts = await getRealEstatePosts(6);

/**
 * 出售分类
 */
const saleCats = [
  { label: "公寓", href: "/real-estate/sale/apartment" },
  { label: "二手房", href: "/real-estate/sale/second-hand" },
  { label: "联排别墅", href: "/real-estate/sale/townhouse" },
  { label: "土地别墅", href: "/real-estate/sale/land-villa" },
  { label: "商业办公楼", href: "/real-estate/sale/commercial" },
  { label: "土地开发", href: "/real-estate/sale/land" },
  { label: "农场", href: "/real-estate/sale/farm" },
  { label: "酒店", href: "/real-estate/sale/hotel" },
];

/**
 * 出租分类
 */
const rentCats = [
  { label: "公寓", href: "/real-estate/rent/apartment" },
  { label: "联排别墅", href: "/real-estate/rent/townhouse" },
  { label: "土地别墅", href: "/real-estate/rent/land-villa" },
  { label: "商业办公", href: "/real-estate/rent/commercial" },
];
---

<Template20Layout title="房产资讯" subtitle="REAL ESTATE">

  <!-- ===============================
       分类入口（Template20 Service 风格）
  ================================ -->
  <section class="service-area section-padding">
    <div class="container">

      <!-- 出售 -->
      <div class="section-title">
        <h2>房产售卖资讯</h2>
      </div>

      <div class="service-grid">
        {saleCats.map((c) => (
          <a class="service-card" href={c.href}>
            <span class="service-dot"></span>
            <h4>{c.label}</h4>
          </a>
        ))}
      </div>

      <!-- 出租 -->
      <div class="section-title mt-40">
        <h2>房产出租资讯</h2>
      </div>

      <div class="service-grid">
        {rentCats.map((c) => (
          <a class="service-card" href={c.href}>
            <span class="service-dot"></span>
            <h4>{c.label}</h4>
          </a>
        ))}
      </div>

    </div>
  </section>

  <!-- ===============================
       最新发布（来自 Contentful）
  ================================ -->
  <section class="blog-area section-padding gray-bg">
    <div class="container">

      <div class="section-title">
        <h2>最新发布</h2>
        <p>后台更新后会自动同步</p>
      </div>

      {posts && posts.length > 0 ? (
        <div class="blog-grid">
          {posts.map((p) => (
            <a class="blog-card" href={`/real-estate/${p.slug}`}>
              <div class="blog-content">
                <span class="blog-tag">{p.category ?? "资讯"}</span>
                <h4>{p.title}</h4>
                {p.publishDate && (
                  <p class="blog-date">
                    {new Date(p.publishDate).toLocaleDateString("zh-CN")}
                  </p>
                )}
              </div>
            </a>
          ))}
        </div>
      ) : (
        <div class="empty">
          <p><strong>目前还没有文章。</strong></p>
          <p>请在 Contentful 中新建 <code>realEstatePost</code> 并发布。</p>
        </div>
      )}

    </div>
  </section>

</Template20Layout>

<style>
/* ===== Service 子页面风格补充（轻量，不冲突模板） ===== */

.service-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
  gap: 20px;
}

.service-card {
  display: block;
  padding: 22px;
  border: 1px solid #e5e5e5;
  border-radius: 10px;
  background: #fff;
  transition: all .25s ease;
}

.service-card:hover {
  transform: translateY(-4px);
  box-shadow: 0 10px 30px rgba(0,0,0,.08);
}

.service-card h4 {
  margin: 0;
  font-size: 16px;
  font-weight: 600;
}

.service-dot {
  display: inline-block;
  width: 8px;
  height: 8px;
  background: #1e3a8a;
  border-radius: 50%;
  margin-bottom: 12px;
}

/* Blog */
.blog-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 24px;
}

.blog-card {
  display: block;
  padding: 24px;
  background: #fff;
  border-radius: 10px;
  border: 1px solid #eee;
}

.blog-tag {
  font-size: 12px;
  color: #666;
}

.blog-date {
  font-size: 12px;
  color: #999;
  margin-top: 6px;
}

.empty {
  padding: 40px;
  text-align: center;
  background: #fff;
  border-radius: 10px;
  border: 1px dashed #ccc;
}
</style>